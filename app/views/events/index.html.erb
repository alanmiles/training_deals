<% provide(:title, "Event schedule") %>
<span class="two-line-header"><h1>Event schedule</h1></span>
<h2><%= "for #{@business.name}, #{@business.city}" %></h2>

<div class="row">
	<aside class="span3">
		<section>
			<%= render "/shared/business_menu" %>
		</section>
	</aside>

	<div class="span8">
		<% unless @business.has_products? %>
			<%= render 'no_products' %>
			<%= link_to "Add a product", 
				new_my_business_product_path(@business), 
				class: "btn btn-large btn-primary" 
			%>
		<% else %>
			<% unless @business.has_events? %>
				<%= render 'no_events' %>
				<%= link_to "Schedule an event", 
					new_my_business_event_path(@business), 
					class: "btn btn-large btn-primary" 
				%>
			<% else %>
				<% unless @business.has_current_and_future_events? %>
					<%= render 'no_current_events' %>
					<%= link_to "Schedule an event", 
						new_my_business_event_path(@business), 
						class: "btn btn-large btn-primary" 
					%>
				<% else %>
					<table class="table table-striped table-bordered table-condensed">
						<tr>
							<th><%= sortable "products.title", "Title" %></th>
							<th><%= sortable "start_date", "Start" %></th>
							<th><%= sortable "end_date", "End" %></th>
							<th></th>
							<th></th>
						</tr>
		 				<% @events.each do |event| %>
		 					<%= content_tag_for :tr, event do %>
		 				 
			 					<td><%= event.product.title %></td>
			 					<td><%= event.start_date.strftime("%d-%b-%y") %></td>
			 					<td><%= event.end_date.strftime("%d-%b-%y") %></td>
			 					<td><%= link_to "details", event_path(event) %></td>
			 					<td>
			 						<%= link_to "delete", event, method: :delete,
											data: { confirm: "Are you sure?" } %>
								</td>
							<% end %>
						<% end %>
		 			</table>
		 		<% end %>
			<% end %>
		<% end %>
	</div>
	<div class="add-top-space navigator">
	    <%= link_to "<- Business details", my_business_path(@business) %> 
	    <% if @business.has_previous_events? %>
	    	| <%= link_to "<- Completed events", 
    			my_business_previous_events_path(@business) %>
    	<% end %>
	    <% if @business.has_schedulable_products? %>
	    	| <%= link_to "Schedule an event ->", 
	    			new_my_business_event_path(@business) %>
	    <% end %>
	</div>
</div>

